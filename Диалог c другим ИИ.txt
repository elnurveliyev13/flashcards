Дальше логичный шаг: подключить это из Moodle (PHP) и сделать кеширование результата.

Ниже даю готовый минимальный набор.

1) PHP-функция (для Moodle), которая отправляет текст в spaCy API

Создай где-то в своём коде (плагин/локальный скрипт) функцию:

function spacy_analyze_text(string $text): array {
    $url = 'https://abcnorsk.no/spacy/analyze';

    $payload = json_encode(['text' => $text], JSON_UNESCAPED_UNICODE);

    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_HTTPHEADER => [
            'Content-Type: application/json',
            'Accept: application/json',
        ],
        CURLOPT_POSTFIELDS => $payload,
        CURLOPT_TIMEOUT => 30,
        CURLOPT_CONNECTTIMEOUT => 10,
    ]);

    $response = curl_exec($ch);

    if ($response === false) {
        $err = curl_error($ch);
        curl_close($ch);
        throw new \RuntimeException('spaCy request failed: ' . $err);
    }

    $http = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    if ($http < 200 || $http >= 300) {
        throw new \RuntimeException("spaCy HTTP $http: " . $response);
    }

    $data = json_decode($response, true);
    if (!is_array($data)) {
        throw new \RuntimeException('Invalid JSON from spaCy: ' . $response);
    }

    return $data; // ['tokens' => [...], 'sents' => [...]]
}

2) Кеширование (очень желательно)

Чтобы не гонять spaCy каждый раз, делай кеш по хэшу текста.

Простейшая идея:

$hash = hash('sha256', $text);
// если в БД уже есть запись по $hash → взять JSON из БД
// иначе → вызвать spacy_analyze_text($text) и сохранить результат


Если хочешь, я дам схему таблицы Moodle (через db/install.xml) или вариант через Moodle Cache API.

3) Важный момент: “hjem” как ADP

В твоём ответе spaCy пометил hjem как ADP — это нормально в рамках их модели, потому что в норвежском такие слова могут вести себя “предложно/наречно” в конструкциях направления. Для твоего продукта это не критично: главное — лемма и индексы.
Если тебе нужно “красивее” для ученика, ты можешь на UI показывать “часть речи (упрощённо)” по своей таблице маппинга (например ADP → “adverb/preposition (direction)” или просто “adverb” для некоторых слов).

4) Следующий шаг: как ты хочешь отображать подсказки

У тебя уже есть Ordbank (без переводов). Обычно делают так:

spaCy даёт lemma + pos + morph

ты ищешь в своём словаре:

совпадение по lemma

если есть несколько — фильтруешь по pos/морфологии/управлению

показываешь карточку слова

Чтобы я дал точный “план склейки”, мне нужно 1 ответ:

Твой текст в Moodle хранится как:

A) чистый текст, или
B) HTML (с тегами, таблицами, форматированием)?

Это критично, потому что при HTML нельзя просто брать индексы start/end “как есть” — сначала надо получить plain text, а потом привязать обратно к отображению.

Если скажешь A или B — я дам следующий шаг без лишней теории: как подсветить слова и сделать клик по слову с карточкой.