<div id="mod_flashcards_container">
  <div class="wrap">
    <header>
      <h1 id="t_appTitle">{{#str}} app_title, mod_flashcards {{/str}}</h1>
      <div class="row">
        <!-- intervals hidden per request -->
        <span class="pill hidden" id="t_intervals">{{#str}} intervals, mod_flashcards {{/str}}</span>
        <select id="langSel">
          <option value="en">English</option>
          <option value="no">Norsk (bokmal)</option>
          <option value="uk">??????????</option>
        </select>
        <label class="pill hidden">
          <span id="t_profile">{{#str}} profile, mod_flashcards {{/str}}</span>
          <select id="profileSel"></select>
          <button id="btnAddProfile" class="iconbtn" title="+">+</button>
        </label>
        <button id="btnInstallApp" class="hidden install-btn" title="{{#str}} install_app, mod_flashcards {{/str}}">
           {{#str}} install_app, mod_flashcards {{/str}}
        </button>
        <button id="btnList" class="iconbtn" title="{{#str}} list, mod_flashcards {{/str}}" aria-label="{{#str}} list, mod_flashcards {{/str}}">??</button>
        <!-- Fullscreen button removed per UX feedback -->
      </div>
    </header>
    <!-- iOS Install Hint (compact, auto-hide) -->
    <div id="iosInstallHint" class="ios-hint hidden">
      <button id="iosHintClose" class="ios-hint-close" title="Close">&times;</button>
       Tap <span class="step step-share">{{#str}} ios_share_button, mod_flashcards {{/str}}</span> -> <span class="step step-add">{{#str}} ios_add_to_home, mod_flashcards {{/str}}</span>
    </div>
    <!-- Progress indicator -->
    <div id="progressBar" class="progress-bar hidden" role="region" aria-live="polite" aria-label="{{#str}} progress_label, mod_flashcards {{/str}}">
      <div>
        <span class="progress-text"><span id="progressCurrent">0</span> / <span id="progressTotal">0</span></span>
        <span class="progress-subtext">{{#str}} cards_remaining, mod_flashcards {{/str}}</span>
      </div>
      <span id="stageBadge" class="stage hidden"><span id="stageEmoji"></span><b id="stageText">0</b></span>
    </div>
    <div class="row hidden">
      <select id="deckSelect"></select>
      <button id="btnActivate">{{#str}} activate, mod_flashcards {{/str}}</button>
      <span id="badge" class="pill">{{#str}} choose, mod_flashcards {{/str}}</span>
      <span id="dueInfo" class="pill" data-label="{{#str}} list_due, mod_flashcards {{/str}}">{{#str}} due, mod_flashcards {{/str}}</span>
      <label class="pill"><input id="packFile" type="file" accept="application/json"><span id="t_loadPack">{{#str}} loadpack, mod_flashcards {{/str}}</span></label>
    </div>
    <div class="grid">
      <div class="card">
        <div class="actionTop">
          <button id="btnList" class="iconbtn" title="{{#str}} list, mod_flashcards {{/str}}" aria-label="{{#str}} list, mod_flashcards {{/str}}">&#128220;</button>
          <button id="btnAddNew" class="iconbtn plus" title="Create new card">+</button>
          <button id="btnEdit" class="iconbtn hidden" title="{{#str}} title_edit, mod_flashcards {{/str}}">&#9998;</button>
          <button id="btnDel" class="iconbtn cross hidden" title="{{#str}} title_del, mod_flashcards {{/str}}">&times;</button>
        </div>
        <video id="cam" class="hidden capture-video" autoplay playsinline muted></video>
        <div class="front" id="front"></div>
        <div class="back" id="back"></div>
        <div id="slotContainer"></div>
        <div class="playRow">
          <button id="btnPlay" class="iconbtn hidden" title="{{#str}} title_play, mod_flashcards {{/str}}">&#128266;</button>
          <button id="btnPlaySlow" class="iconbtn hidden" title="{{#str}} title_slow, mod_flashcards {{/str}}">&#128034;</button>
        </div>
        <div class="meta">
          <button id="btnRevealNext" class="primary">{{#str}} showmore, mod_flashcards {{/str}}</button>
          <span><b>Due:</b> <span id="due">-</span></span>
        </div>
        <div class="row2">
          
          <button id="btnEasy" class="ok">{{#str}} easy, mod_flashcards {{/str}}</button>
          <button id="btnNormal" class="mid">{{#str}} normal, mod_flashcards {{/str}}</button>
          <button id="btnHard" class="hard">{{#str}} hard, mod_flashcards {{/str}}</button>
        </div>
        <div id="emptyState" class="empty hidden">{{#str}} empty, mod_flashcards {{/str}}</div>
      </div>
      <!-- Card creation form (collapsible) -->
      <div class="card card-form-collapsed" id="cardCreationFormWrap">
        <div class="card-form-toggle" id="btnToggleForm">
          
          <div>Add New Card</div>
        </div>
        <div class="card-form-content" id="cardCreationForm">
          <div class="actionTop">
            <button id="btnFormReset" class="iconbtn ghost" title="Clear form"><span class="rot">&#8634;</span></button><button id="btnCancelEdit" class="iconbtn cross" title="Cancel">&times;</button>
          </div>
          <div class="slot">
            <span class="tag" id="t_addOwn">{{#str}} addown, mod_flashcards {{/str}}</span>
          </div>
        <div class="slot">
          <span class="tag" id="t_pickAudio">{{#str}} audio, mod_flashcards {{/str}}</span>
          <div class="previewRow">
            <input id="uAudio" type="file" accept="audio/*" class="hidden">
            <button id="btnChooseAud" class="btnFile">{{#str}} choosefile, mod_flashcards {{/str}}</button><span id="audName" class="fileName"></span>
            <button id="btnClearAud" class="iconbtn" title="Clear">&times;</button>
            <div class="rec-wrap">
              <button id="btnRec"  class="iconbtn micbtn" title="{{#str}} title_record, mod_flashcards {{/str}}" aria-label="{{#str}} title_record, mod_flashcards {{/str}}">&#127897;&#65039;</button>
              <button id="btnStop" class="iconbtn hidden" title="{{#str}} title_stop, mod_flashcards {{/str}}" aria-label="{{#str}} title_stop, mod_flashcards {{/str}}">&#9209;</button>
              <span id="recTimer" class="rec-timer hidden">00:00</span>
              <div id="recHint" class="rec-hint">{{#str}} press_hold_to_record, mod_flashcards {{/str}}</div>
            </div>
          </div>
          <audio id="audPrev" class="hidden" controls preload="metadata"></audio>
        </div>
        <div class="slot">
          <span class="tag" id="t_pickPhoto">{{#str}} image, mod_flashcards {{/str}}</span>
          <div class="previewRow">
            <input id="uImage" type="file" accept="image/*" class="hidden">
            <button id="btnChooseImg" class="btnFile">{{#str}} choosefile, mod_flashcards {{/str}}</button><span id="imgName" class="fileName"></span>
            <button id="btnClearImg" class="iconbtn" title="Clear">&times;</button>
            <!-- Camera controls positioned near image picker -->
            <button id="btnOpenCam" class="iconbtn" title="{{#str}} title_camera, mod_flashcards {{/str}}">&#128247;</button>
            <button id="btnShot" class="iconbtn hidden" title="{{#str}} title_take, mod_flashcards {{/str}}">&#128248;</button>
            <button id="btnCloseCam" class="iconbtn cross hidden" title="{{#str}} title_closecam, mod_flashcards {{/str}}">&times;</button>
          </div>
          <img id="imgPrev" class="media hidden" alt=""/>
        </div>
        <div class="slot">
          <span class="tag" id="t_frontText">{{#str}} front, mod_flashcards {{/str}}</span>
          <textarea id="uFront" placeholder="Front..."></textarea>
        </div>
        <div class="slot">
          <span class="tag" id="t_explanationText">{{#str}} explanation, mod_flashcards {{/str}}</span>
          <textarea id="uExplanation" placeholder="Explanation..."></textarea>
        </div>
        <!-- Language-aware translation fields -->
        <div class="slot" id="slot_translation_local">
          <span class="tag" id="tag_trans_local">Translation (?)</span>
          <textarea id="uTransLocal" placeholder="Translation..."></textarea>
        </div>
        <div class="slot" id="slot_translation_en">
          <span class="tag">Translation (English)</span>
          <textarea id="uTransEn" placeholder="Translation (English)..."></textarea>
        </div>
        <!-- Linguistic enrichment fields -->
        <div class="slot">
          <span class="tag">{{#str}} transcription, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:center;flex-wrap:wrap">
            <input id="uTranscription" type="text" placeholder="[?sp?l?]" style="flex:1;min-width:220px;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px">
            <button id="btnFetchTranscription" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} pos, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:center;flex-wrap:wrap">
            <select id="uPOS">
              <option value="">-</option>
              <option value="substantiv">Substantiv ? navn pa steder, personer, ting og fenomener</option>
              <option value="adjektiv">Adjektiv ? beskriver substantiv</option>
              <option value="pronomen">Pronomen ? settes i stedet for et substantiv</option>
              <option value="determinativ">Determinativ ? bestemmer substantivet n?rmere</option>
              <option value="verb">Verb ? navn pa en handling</option>
              <option value="adverb">Adverb ? beskriver/modifiserer verb, adjektiv eller andre adverb</option>
              <option value="preposisjon">Preposisjon ? forteller hvor verbet/substantivet befinner seg i forhold til et annet verb/substantiv i bade tid og rom</option>
              <option value="konjunksjon">Konjunksjon ? binder sammen to og to ord av samme ordklasse eller to helsetninger</option>
              <option value="subjunksjon">Subjunksjon ? innleder leddsetninger</option>
              <option value="interjeksjon">Interjeksjon ? spesielle ord som gir et bilde av lyder som ikke kan skrives, folelser eller meninger</option>
              <option value="other">Annet</option>
            </select>
            <button id="btnFetchPOS" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
          <div id="uPOSHelp" class="small"></div>
        </div>
        <div class="slot hidden" id="slot_gender">
          <span class="tag">{{#str}} gender, mod_flashcards {{/str}}</span>
          <select id="uGender">
            <option value="">-</option>
            <option value="intetkjonn">{{#str}} gender_neuter, mod_flashcards {{/str}}</option>
            <option value="hankjonn">{{#str}} gender_masculine, mod_flashcards {{/str}}</option>
            <option value="hunkjonn">{{#str}} gender_feminine, mod_flashcards {{/str}}</option>
          </select>
        </div>
        <div class="slot hidden" id="slot_noun_forms">
          <span class="tag">{{#str}} noun_forms, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;flex-wrap:wrap">
            <input id="uNounIndefSg" type="text" placeholder="{{#str}} indef_sg, mod_flashcards {{/str}}" style="min-width:200px;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px">
            <input id="uNounDefSg" type="text" placeholder="{{#str}} def_sg, mod_flashcards {{/str}}" style="min-width:200px;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px">
            <input id="uNounIndefPl" type="text" placeholder="{{#str}} indef_pl, mod_flashcards {{/str}}" style="min-width:200px;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px">
            <input id="uNounDefPl" type="text" placeholder="{{#str}} def_pl, mod_flashcards {{/str}}" style="min-width:200px;background:#0b1220;color:#e5e7eb;border:1px solid #374151;border-radius:10px;padding:10px">
            <button id="btnFetchNounForms" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} collocations, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:flex-start;flex-wrap:wrap">
            <textarea id="uCollocations" placeholder="one per line..." style="min-height:66px"></textarea>
            <button id="btnFetchCollocations" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} examples, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:flex-start;flex-wrap:wrap">
            <textarea id="uExamples" placeholder="one per line..." style="min-height:66px"></textarea>
            <button id="btnFetchExamples" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} antonyms, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:flex-start;flex-wrap:wrap">
            <textarea id="uAntonyms" placeholder="one per line..." style="min-height:66px"></textarea>
            <button id="btnFetchAntonyms" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} cognates, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:flex-start;flex-wrap:wrap">
            <textarea id="uCognates" placeholder="one per line..." style="min-height:66px"></textarea>
            <button id="btnFetchCognates" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag">{{#str}} sayings, mod_flashcards {{/str}}</span>
          <div class="row has-action" style="gap:6px;align-items:flex-start;flex-wrap:wrap">
            <textarea id="uSayings" placeholder="one per line..." style="min-height:66px"></textarea>
            <button id="btnFetchSayings" class="iconbtn" title="{{#str}} autofill, mod_flashcards {{/str}}">&#128269;</button>
          </div>
        </div>
        <div class="slot">
          <span class="tag" id="t_order">{{#str}} order, mod_flashcards {{/str}}</span>
          <div id="orderChips" class="chips">
            <button class="chip" data-kind="audio"       id="chip_audio">{{#str}} audio, mod_flashcards {{/str}}</button>
            <button class="chip" data-kind="image"       id="chip_image">{{#str}} image, mod_flashcards {{/str}}</button>
            <button class="chip" data-kind="text"        id="chip_text">{{#str}} front, mod_flashcards {{/str}}</button>
            <button class="chip" data-kind="explanation" id="chip_explanation">{{#str}} explanation, mod_flashcards {{/str}}</button>
            <button class="chip" data-kind="translation" id="chip_translation">{{#str}} back, mod_flashcards {{/str}}</button>
          </div>
          <div class="small" id="orderPreview">audio -> image -> text -> explanation -> translation</div>
        </div>
        <div class="row2" style="display:flex">
          <button id="btnUpdate" class="ok">Update</button>
          <button id="btnAdd" class="mid">Create new</button>
        </div>
        <div class="mono" id="status"></div>
        <div class="small" id="hintPerms">Open via HTTPS for camera/mic permissions.</div>
        </div>
      </div>
    </div>
    <div class="mono" id="debug"></div>
  </div>
  
  <!-- Fixed bottom action bar (feature-flagged via data-ux-bottom="1") -->
  <div id="bottomActions" class="bottom-actions hidden" role="toolbar" aria-label="{{#str}} rating_actions, mod_flashcards {{/str}}">
    <button id="btnEasyBottom" class="ok">{{#str}} easy, mod_flashcards {{/str}}</button>
    <button id="btnNormalBottom" class="mid">{{#str}} normal, mod_flashcards {{/str}}</button>
    <button id="btnHardBottom" class="hard">{{#str}} hard, mod_flashcards {{/str}}</button>
  </div>
  <div id="listModal" class="modal" role="dialog" aria-modal="true">
    <div class="box">
      <div class="row" style="justify-content:space-between;align-items:center;padding-left:12px">
        <strong id="t_listTitle">{{#str}} cards, mod_flashcards {{/str}}</strong>
        <button id="btnCloseList" class="iconbtn cross" title="{{#str}} close, mod_flashcards {{/str}}">&times;</button>
      </div>
      <div class="row" style="margin-top:10px;gap:10px;flex-wrap:wrap;padding-left:12px">
        <input id="listSearch" type="search" placeholder="{{#str}} search_ph, mod_flashcards {{/str}}" style="width:340px">
        <select id="listFilterDue" style="padding:6px">
          <option value="all">All cards</option>
          <option value="due">Due only</option>
          <option value="future">Future only</option>
        </select>
        <span id="listCount" class="badge">0</span>
      </div>
      <div style="overflow:auto;margin-top:10px">
        <table class="table" id="listTable">
          <thead>
            <tr>
              <th id="thFront">{{#str}} list_front, mod_flashcards {{/str}}</th>
              <th id="thStage">{{#str}} list_stage, mod_flashcards {{/str}}</th>
              <th id="thDue">{{#str}} list_due, mod_flashcards {{/str}}</th>
              <th id="thActions">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="row" id="listPagination" style="margin-top:10px;justify-content:center;gap:10px;display:none">
        <button id="btnPagePrev" class="btn">Previous</button>
        <span id="pageInfo" class="badge">Page 1 of 1</span>
        <button id="btnPageNext" class="btn">Next</button>
      </div>
    </div>
  </div>
<!-- Field prompt modal for staged tasks -->
<div id="fieldPrompt" class="modal" role="dialog" aria-modal="true">
  <div class="box" style="max-width:560px">
    <div class="row" style="justify-content:space-between;align-items:center">
      <strong id="fpTitle">{{#str}} fill_field, mod_flashcards {{/str}}</strong>
      <button id="fpClose" class="iconbtn cross">&times;</button>
    </div>
    <div id="fpBody" style="margin-top:10px"></div>
    <div class="row" style="gap:8px;margin-top:12px">
      <button id="fpSave" class="ok">{{#str}} save, mod_flashcards {{/str}}</button>
      <button id="fpSkip" class="mid">{{#str}} skip, mod_flashcards {{/str}}</button>
    </div>
  </div>
</div>

