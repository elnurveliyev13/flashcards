:root{--bg:#0f172a;--fg:#e5e7eb;--muted:#9ca3af;--card:#111827;--btn:#1f2937;--ok:#22c55e;--mid:#3b82f6;--hard:#f59e0b}
.wrap{max-width:1000px;margin:0 auto;padding:18px 18px 120px;display:grid;gap:14px}
/* Fill viewport background for this module */
#mod_flashcards_container{background:var(--bg);color:var(--fg)}
@media (max-width:620px){
  /* On small screens, remove side paddings and stretch to full width */
  .wrap{max-width:none;width:100%;padding-left:0;padding-right:0}
  /* Break out of Moodle content padding to avoid white gutters */
  #mod_flashcards_container{margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);}
}
header{padding:16px 18px 12px 18px}
.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
h1{margin:0;font-size:20px;color:#f8fafc;font-weight:700}
.header-actions{display:flex;gap:8px;align-items:center}
.install-btn-compact{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;padding:0;background:rgba(103,126,234,0.15);border:1px solid rgba(103,126,234,0.3);border-radius:8px;color:#9ca3af;transition:all 0.2s}
.install-btn-compact:hover{background:rgba(103,126,234,0.25);color:#e5e7eb}
.install-btn-compact svg{display:block}
.header-progress{display:flex;flex-direction:column;gap:6px}
.progress-info{display:flex;align-items:center;gap:8px;font-size:13px;color:#9ca3af}
.progress-counter{font-weight:600;color:#e5e7eb;font-size:14px}
.progress-track{height:6px;background:#1e293b;border-radius:3px;overflow:hidden;position:relative}
.progress-fill-mini{position:absolute;top:0;left:0;height:100%;background:linear-gradient(90deg, #2196f3 0%, #1976d2 100%);transition:width 0.3s ease;width:0}
/* Card stage indicator */
.card-stage-info{display:flex;justify-content:center;margin-top:12px}
.stage-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:rgba(33,150,243,0.12);border:1px solid rgba(33,150,243,0.25);border-radius:20px;font-size:13px;color:#9ca3af}
.stage-pill b{color:#60a5fa;font-weight:600;font-size:14px}
/* Hide header list button; we place it inside the card actions */
header #btnList{display:none}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.pill{padding:8px 12px;border-radius:999px;background:#0b1220;border:1px dashed #374151;color:var(--muted);font-size:13px}
button{background:var(--btn);color:#d1d5db;border:1px solid #374151;border-radius:14px;padding:12px 16px;font-size:16px;cursor:pointer; transition:all 0.15s ease;}
button:hover{filter:brightness(1.05)}
button:disabled{opacity:0.5;cursor:not-allowed}
button:disabled:hover{filter:none}
.iconbtn{width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;font-size:18px}`r`n  .iconbtn.ghost{background:#0b1220;border:1px solid #374151}`r`n  .iconbtn .rot{display:inline-block; transform:rotate(-25deg)}`r`n  .iconbtn.plus{font-size:20px}`r`n  .iconbtn.cross{font-size:20px}
.iconbtn, .btnFile{ -webkit-user-select:none; user-select:none; -webkit-touch-callout:none }
.iconbtn *{ pointer-events:none }
.iconbtn.recording{ background:#7f1d1d; border-color:#ef4444; box-shadow:0 0 0 3px rgba(239,68,68,.25) inset, 0 0 8px rgba(239,68,68,.6) }
.rec-timer{ color:#fca5a5; font-size:12px; margin-left:8px }
/* Press-and-hold mic button */
.rec-wrap{ display:flex; align-items:center; gap:8px; flex-wrap:wrap }
.micbtn{ width:72px; height:72px; border-radius:50%; font-size:32px; display:inline-flex; align-items:center; justify-content:center }
.rec-hint{ color:var(--muted); font-size:13px }
`r`n
select{background:#0b1220;color:#d1d5db;border:1px solid #374151;border-radius:12px;padding:10px 12px;font-size:14px}
#langSel{padding:6px 10px;font-size:13px;min-width:60px}
.grid{display:grid;grid-template-columns:1fr;gap:14px}
  .grid.edit-mode{grid-template-columns:1fr}
/* Swap study/editor views */
.grid > #cardCreationFormWrap { display:none }
.grid.edit-mode > .card:first-child { display:none }
.grid.edit-mode > #cardCreationFormWrap { display:block }
.grid.edit-mode > #cardCreationFormWrap .card-form-toggle { display:none }
.grid.edit-mode > #cardCreationFormWrap .card-form-content { display:block !important }
/* Always hide fixed bottom bar when embedding rating buttons in card */
#mod_flashcards_container:not([data-ux-bottom="1"]) #bottomActions{ display:none !important }
@media (max-width:900px){.grid{grid-template-columns:1fr}}
.card{position:relative;background:var(--card);border:1px solid #374151;border-radius:16px;padding:16px}
.capture-video{width:100%;border-radius:12px;display:block}
.actionTop{position:absolute;top:8px;right:8px;display:flex;gap:6px}
.front{font-size:24px;margin-bottom:10px}
.back{color:var(--muted);margin-bottom:12px;min-height:2.2em}
/* improve contrast */
.back{color:#e2e8f0}
.table td{color:#e5e7eb}
.table th{color:#f1f5f9}
textarea, input[type=search]{color:#f1f5f9}`r`n  #listSearch{ height:38px; padding:8px 14px; border-radius:14px; border-color:#3b4456 }
/* Make text inputs visually consistent with textareas */
input[type=text]{color:#f1f5f9; background:#0b1220; border:1px solid #374151; border-radius:10px; padding:10px}
textarea::placeholder{color:#64748b;opacity:0.7}
input[type=search]::placeholder{color:#64748b;opacity:0.7}
input[type=text]::placeholder{color:#64748b;opacity:0.7}
/* force high-contrast text inside inputs/selects in Moodle themes */
#mod_flashcards_container textarea,
#mod_flashcards_container input[type=search],
#mod_flashcards_container select,
#mod_flashcards_container option { color:#f1f5f9 !important; }
#mod_flashcards_container select { background:#0b1220; border:1px solid #374151; }
#mod_flashcards_container select:disabled { opacity:0.9; }
/* play row below content */
.playRow{display:flex;gap:6px;align-items:center;margin:10px 0}
.meta{display:flex;gap:8px;color:var(--muted);font-size:13px;align-items:center;flex-wrap:wrap;margin-top:8px}
.row2{display:flex;gap:10px;align-items:center;margin-top:12px}
.ok{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.35)}
.mid{background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.35)}
.hard{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.35)}
.hidden{display:none !important}
.mono{font:12px/1.2 ui-monospace,Menlo,Consolas,monospace}
.small{font-size:12px;color:var(--muted)}
textarea{width:100%;min-height:80px;border-radius:10px;padding:10px;background:#0b1220;color:#d1d5db;border:1px solid #374151}
label{display:inline-flex;align-items:center;gap:6px}
/* Old stage badge styles (deprecated) */
#stageEmoji{display:none}
#btnRevealNext.primary{outline:2px solid var(--mid)}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{padding:8px 10px;border-radius:999px;border:1px solid #374151;background:#0b1220;color:#cbd5e1;cursor:pointer}
.chip.active{background:#0e223e;border-color:#4269ff}
.previewRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
img.media{max-width:180px;max-height:120px;object-fit:cover;border-radius:12px}
audio{max-width:260px}
.slot{margin:6px 0}
.slot .tag{font-size:12px;color:#9aa3b1;margin-bottom:4px}
/* Ensure new enrichment rows align to full width, and fields flex like textareas */
#mod_flashcards_container .slot .row{width:100%}
#mod_flashcards_container .slot .row textarea{flex:1 1 auto; min-width:220px}
#mod_flashcards_container .slot .row input[type=text]{flex:1 1 auto; min-width:220px}
/* Reserve space for inline action icon so borders align with full-width fields */
/* Action rows: behave like full-width blocks (exactly like legacy textareas), icon overlays on the right */
#mod_flashcards_container .slot .row.has-action{ position:relative; display:block; width:100%; padding-left:16px }
#mod_flashcards_container .slot .row.has-action > .iconbtn{ position:absolute; right:10px; top:50%; transform:translateY(-50%); z-index:1 }
#mod_flashcards_container .slot .row.has-action > input[type=text],
#mod_flashcards_container .slot .row.has-action > textarea,
#mod_flashcards_container .slot .row.has-action > select{ width:100%; box-sizing:border-box; padding-right:44px; margin-left:0 }
/* Bright text inside modal prompt editors */
#mod_flashcards_container .modal .box input[type=text],
#mod_flashcards_container .modal .box textarea{ color:#f1f5f9 !important; background:#0b1220; border:1px solid #374151; }
.empty{padding:28px;border:1px dashed #374151;border-radius:14px;text-align:center;color:#9aa3b1}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px}
.modal>.box{max-width:960px;width:100%;max-height:85vh;overflow:auto;background:#0b1220;border:1px solid #374151;border-radius:16px;padding:16px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #253047;padding:8px;text-align:left;font-size:14px}
.table th{color:#9aa3b1;font-weight:600;position:sticky;top:0;background:#0b1220}`r`n  .table td.playcell{border-bottom:0;padding-top:4px;padding-bottom:4px}`r`n
input[type=search]{background:#0b1220;border:1px solid #374151;border-radius:12px;color:#e5e7eb;padding:8px 10px}
#mod_flashcards_container input[type=search]{background:#0b1220 !important;border-color:#374151 !important;color:#e5e7eb !important;}`r`n  #listSearch{ height:38px; padding:8px 14px; border-radius:14px; border-color:#3b4456 }
.badge{padding:2px 8px;border-radius:999px;border:1px solid #374151;font-size:12px;background:#0b1220}
#listSearch{ background:#0b1220 !important; border:1px solid #374151 !important; color:#e5e7eb !important; height:36px; padding:8px 14px; border-radius:12px !important; }
#listFilterDue{ background:#0b1220 !important; border:1px solid #374151 !important; color:#e5e7eb !important; height:36px; border-radius:12px !important; }
.btnFile{background:#0b1220;border:1px solid #374151;border-radius:12px;padding:10px 12px}
.fileName{font-size:12px;color:#9aa3b1;margin-left:6px}
/* PWA Install Button */
.install-btn{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border:none;
  color:#fff;
  font-weight:600;
  padding:10px 16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(102,126,234,0.3);
  transition:all 0.3s ease;
}
.install-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 16px rgba(102,126,234,0.4);
}
.install-btn:active{
  transform:translateY(0);
}
.install-btn-block{
  display:flex;
  align-items:center;
  justify-content:center;
  margin:24px auto 0;
  width:100%;
  max-width:360px;
  padding:14px 20px;
  font-size:16px;
  gap:10px;
  text-align:center;
  line-height:1.35;
}
@media (max-width:600px){
  .install-btn-block{
    max-width:none;
    margin-top:20px;
  }
}
/* iOS Install Hint */
.ios-hint{
  position:relative;
  background:linear-gradient(135deg, rgba(15,36,68,0.95), rgba(17,51,99,0.95));
  border:1px solid rgba(56,189,248,0.55);
  border-radius:18px;
  padding:20px 56px 20px 20px;
  margin:20px auto 0;
  width:100%;
  max-width:360px;
  color:#f8fafc;
  font-size:16px;
  line-height:1.6;
  display:flex;
  flex-direction:column;
  gap:14px;
  box-shadow:0 14px 38px rgba(15,118,222,0.35);
}
.ios-hint-title{
  font-size:20px;
  font-weight:700;
  letter-spacing:0.01em;
}
.ios-hint-steps{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:10px;
}
.ios-hint-step-text{
  font-weight:500;
}
.ios-hint-arrow{
  font-size:20px;
  color:#38bdf8;
  font-weight:600;
}
.ios-hint .step{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:rgba(15,23,42,0.65);
  padding:6px 10px;
  border-radius:999px;
  font-weight:700;
  margin:0;
  font-size:15px;
  line-height:1.2;
  color:#e2e8f0;
  box-shadow:0 4px 12px rgba(22,78,199,0.35);
}
/* Icons after step labels (iOS-style) */
.ios-hint .step-share::after{
  content:'';
  display:inline-block;
  width:16px;height:16px;margin-left:6px;vertical-align:-1px;
  background-repeat:no-repeat;background-size:16px 16px;
background-image:url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23e2e8f0%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22%3E%3Crect x=%224%22 y=%2212%22 width=%2216%22 height=%228%22 rx=%222%22/%3E%3Cpath d=%22M12 4v10%22/%3E%3Cpath d=%22M8 8l4-4 4 4%22/%3E%3C/svg%3E");
}
.ios-hint .step-add::after{
  content:'';
  display:inline-block;
  width:16px;height:16px;margin-left:6px;vertical-align:-1px;
  background-repeat:no-repeat;background-size:16px 16px;
background-image:url("data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%23e2e8f0%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22%3E%3Crect x=%223%22 y=%223%22 width=%2218%22 height=%2218%22 rx=%224%22/%3E%3Cpath d=%22M12 8v8%22/%3E%3Cpath d=%22M8 12h8%22/%3E%3C/svg%3E");
}
.ios-hint-close{
  position:absolute;
  top:14px;
  right:14px;
  background:rgba(15,23,42,0.35);
  border:none;
  color:#cbd5f5;
  font-size:18px;
  padding:4px;
  cursor:pointer;
  border-radius:8px;
  width:28px;
  height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:background 0.2s ease,color 0.2s ease;
}
.ios-hint-close:hover{
  background:rgba(148,163,184,0.35);
  color:#f8fafc;
}
@media (max-width:600px){
  .ios-hint{
    max-width:none;
    padding:18px 48px 18px 18px;
    margin-top:18px;
  }
  .ios-hint-steps{
    gap:8px;
  }
  .ios-hint .step{
    font-size:14px;
    padding:5px 9px;
  }
}
/* UX IMPROVEMENTS */
.front{font-size:32px !important;font-weight:500;line-height:1.3;color:#f1f5f9}
.back{font-size:18px !important;line-height:1.5}
.bottom-actions{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:min(100%,1000px);background:linear-gradient(180deg, transparent 0%, rgba(15,23,42,0.92) 12%, rgba(15,23,42,1) 100%);backdrop-filter:blur(12px);padding:10px 14px;padding-bottom:max(10px, env(safe-area-inset-bottom));display:flex;gap:10px;justify-content:center;align-items:stretch;z-index:1000;border-top:1px solid rgba(55,65,81,0.5);box-shadow:0 -6px 24px rgba(0,0,0,0.4);box-sizing:border-box}
.bottom-actions button{flex:1;max-width:140px;font-size:16px;font-weight:700;padding:16px 20px;border-radius:16px;transition:all 0.15s ease}
.bottom-actions button:active{transform:scale(0.92)}
.bottom-actions .ok{background:rgba(34,197,94,0.22);border:2px solid rgba(34,197,94,0.6);color:#4ade80}
.bottom-actions .mid{background:rgba(59,130,246,0.22);border:2px solid rgba(59,130,246,0.6);color:#60a5fa}
.bottom-actions .hard{background:rgba(245,158,11,0.22);border:2px solid rgba(245,158,11,0.6);color:#fbbf24}
/* Old progress bar styles (deprecated) */
.card-form-collapsed .card-form-content{display:none}
.card-form-toggle{background:#1f2937;border:1px dashed #374151;border-radius:12px;padding:16px;text-align:center;cursor:pointer;transition:all 0.2s ease;font-size:16px;color:#9ca3af}
.card-form-toggle:hover{background:#374151;border-color:#4b5563;color:#e5e7eb}
.card-form-toggle .icon{font-size:24px;margin-bottom:4px}.meta{margin-top:12px}
@media (max-width:600px){#langSel{display:none}}
  .iconbtn.cross{font-size: 20px !important;}
.iconbtn.plus{font-size: 24px !important;}
/* Fullscreen (native or fallback) */
#mod_flashcards_container.fs-active{position:fixed;inset:0;z-index:99999;background:var(--bg);width:100vw;height:100svh;overflow:auto}
#mod_flashcards_container.fs-active .wrap{max-width:none;width:100%;min-height:100%;padding-left:12px;padding-right:12px}
/* On iOS account for safe areas */
@supports(padding:max(env(safe-area-inset-bottom),0px)){
  #mod_flashcards_container.fs-active{padding-bottom:max(env(safe-area-inset-bottom),0px)}
}
/* Mobile offsets removed - now handled globally with padding */
/* Rating buttons inside the card: match fixed bar palette */
.row2 .ok{background:rgba(34,197,94,0.22);border:2px solid rgba(34,197,94,0.6);color:#4ade80}
.row2 .mid{background:rgba(59,130,246,0.22);border:2px solid rgba(59,130,246,0.6);color:#60a5fa}
.row2 .hard{background:rgba(245,158,11,0.22);border:2px solid rgba(245,158,11,0.6);color:#fbbf24}
.row2 button:active{transform:scale(0.92)}
@media (prefers-reduced-motion: reduce){
  * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
  .bottom-actions button:active, .row2 button:active { transform:none !important }
}
